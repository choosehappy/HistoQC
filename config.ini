[pipeline]
steps= BasicModule.getBasicStats
    BasicModule.getMag
    ClassificationModule.byExampleWithFeatures:pen_markings
    #ClassificationModule.byExampleWithFeatures:pen_markings_red
    ClassificationModule.byExampleWithFeatures:coverslip_edge
    #LightDarkModule.getIntensityThresholdPercent:bubble
    LightDarkModule.getIntensityThresholdPercent:tissue
    #BubbleRegionByRegion.pixelWise
    LightDarkModule.getIntensityThresholdPercent:darktissue
    MorphologyModule.removeSmallObjects
    MorphologyModule.fillSmallHoles
    BlurDetectionModule.identifyBlurryRegions
    BasicModule.finalProcessingSpur
    BasicModule.finalProcessingArea
    HistogramModule.compareToTemplates
    HistogramModule.getHistogram
    BrightContrastModule.getContrast
    BrightContrastModule.getBrightness
    DeconvolutionModule.seperateStains
    SaveModule.saveFinalMask
    SaveModule.saveThumbnails
    BasicModule.finalComputations


[BaseImage.BaseImage]
image_work_size = 3

[BasicModule.getBasicStats]
image_work_size = 3

[BasicModule.getMag]
confirm: False

#[ClassificationModule.byExample]
[ClassificationModule.byExampleWithFeatures:pen_markings]
name: pen_markings
tresh: .9
;examples: ./models/pen_markings_he/1pen_green.png:./models/pen_markings_he/pen_green_mask.png
;          ./models/pen_markings_he/pen_red.png:./models/pen_markings_he/pen_red_mask.png

examples: ./pen/1k_version/pen_green.png:./pen/1k_version/pen_green_mask.png
          #./pen/1k_version/pen_red.png:./pen/1k_version/pen_red_mask.png

area_thresh: 100
features:  frangi
           laplace
           rgb
           #lbp
           #gabor
           #median
           #gaussian

laplace_ksize: 3

frangi_scale_range: (1,10)
frangi_scale_step: 2
frangi_beta1: .5
frangi_beta2: 15
frangi_black_ridges: True

gabor_theta: 4
gabor_sigma: (1,3)
gabor_frequency: (0.05, 0.25)

lbp_radius: 3
lbp_points: 24
lbp_method: default

median_disk_size: 3

#gaussian_sigma: 1
#gaussian_multichan: False

;[ClassificationModule.byExampleWithFeatures:pen_markings_red]
;name: pen_markings_red
;tresh: .9
;
;examples: ./pen/1k_version/pen_red.png:./pen/1k_version/pen_red_mask.png
;          ./pen/1k_version/red.png:./pen/1k_version/red_mask.png
;
;area_thresh: 100
;features:  frangi
;           laplace
;           rgb
;           #lbp
;           #gabor
;           #median
;           #gaussian
;
;laplace_ksize: 3
;
;frangi_scale_range: (1,10)
;frangi_scale_step: 2
;frangi_beta1: .5
;frangi_beta2: 15
;frangi_black_ridges: True
;
;gabor_theta: 4
;gabor_sigma: (1,3)
;gabor_frequency: (0.05, 0.25)
;
;lbp_radius: 3
;lbp_points: 24
;lbp_method: default
;
;median_disk_size: 3
;
;#gaussian_sigma: 1
;#gaussian_multichan: False

[ClassificationModule.byExampleWithFeatures:coverslip_edge]
name: coverslip_edge
tresh: .9

examples: ./models/coverslip_edge_he/coverslip_edge.png:./models/coverslip_edge_he/coverslip_edge_mask.png

area_thresh: 16000
features:  frangi
           laplace
           rgb

#[PenMarkingModule.identifyPenMarking]
#tsv_file: ./models/penmarkings/he.tsv
#threshold: .5
#blur_radius: 7
#blur_threshold: .2

[LightDarkModule.getIntensityThresholdPercent:bubble]
name: bubble
upper_threshold: .94
lower_threshold: .82
upper_variance: 11
invert: true


[LightDarkModule.getIntensityThresholdPercent:tissue]
name: nonwhite
upper_threshold: .9
lower_var: 10

[LightDarkModule.getIntensityThresholdPercent:darktissue]
name: dark
upper_threshold: .15
invert: true


[LightDarkModule.getTissuePercent]
thresh: .8

[LightDarkModule.getDarkTissuePercent]
thresh: .15

[MorphologyModule.removeSmallObjects]
min_size: 64

[MorphologyModule.fillSmallHoles]
min_size: 64

[HistogramModule.compareToTemplates]
limit_to_mask: True
bins: 20
templates= ./templates/template1.png
           ./templates/template2.png
           ./templates/template3.png
           ./templates/template4.png

[HistogramModule.getHistogram]
limit_to_mask: True
bins: 20

[BrightContrastModule.getContrast]
limit_to_mask: True

[BrightContrastModule.getBrightness]
limit_to_mask: True

[SaveModule.saveFinalMask]
overlay: True

[SaveModule.saveThumbnails]
image_work_size: 3
small_dim: 500

[BlurDetectionModule.identifyBlurryRegions]
image_work_size = 2
blur_radius: 7
blur_threshold: .02


[BasicModule.finalComputations]

[BasicModule.finalProcessingSpur]
disk_radius: 25

[BasicModule.finalProcessingArea]
area_thresh: 90000

[DeconvolutionModule.seperateStains]
;hed_from_rgb: Hematoxylin + Eosin + DAB
;hdx_from_rgb: Hematoxylin + DAB
;fgx_from_rgb: Feulgen + Light Green
;bex_from_rgb: Giemsa stain : Methyl Blue + Eosin
;rbd_from_rgb: FastRed + FastBlue + DAB
;gdx_from_rgb: Methyl Green + DAB
;hax_from_rgb: Hematoxylin + AEC
;bro_from_rgb: Blue matrix Anilline Blue + Red matrix Azocarmine + Orange matrix Orange-G
;bpx_from_rgb: Methyl Blue + Ponceau Fuchsin
;ahx_from_rgb: Alcian Blue + Hematoxylin
;hpx_from_rgb: Hematoxylin + PAS
stain: hed_from_rgb
use_mask: True

