!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var o in r)("object"==typeof exports?exports:t)[o]=r[o]}}(window,function(){return function(t){var e={};function r(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){"use strict";const o=Object.prototype.toString;t.exports=function(t){return o.call(t).endsWith("Array]")}},function(t,e,r){"use strict";var o=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}};function n(t,e){return Math.floor(e()*t)}function i(t){for(var e=[],r=0;r<t;r++)e.push(void 0);return e}function s(t,e){return i(t).map(function(){return e})}function h(t){return s(t,0)}function a(t){return t.reduce(function(t,e){return t+e})}Object.defineProperty(e,"__esModule",{value:!0}),e.tauRandInt=n,e.tauRand=function(t){return t()},e.norm=function(t){var e,r,n=0;try{for(var i=o(t),s=i.next();!s.done;s=i.next()){var h=s.value;n+=Math.pow(h,2)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return Math.sqrt(n)},e.empty=i,e.range=function(t){return i(t).map(function(t,e){return e})},e.filled=s,e.zeros=h,e.ones=function(t){return s(t,1)},e.linear=function(t,e,r){return i(r).map(function(o,n){return t+n*((e-t)/(r-1))})},e.sum=a,e.mean=function(t){return a(t)/t.length},e.max=function(t){for(var e=0,r=0;r<t.length;r++)e=t[r]>e?t[r]:e;return e},e.max2d=function(t){for(var e=0,r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)e=t[r][o]>e?t[r][o]:e;return e},e.rejectionSample=function(t,e,r){for(var o=h(t),i=0;i<t;i++)for(var s=!0;s;){for(var a=n(e,r),u=!1,l=0;l<i;l++)if(a===o[l]){u=!0;break}u||(s=!1),o[i]=a}return o},e.reshape2d=function(t,e,r){var o=[],n=0;if(t.length!==e*r)throw new Error("Array dimensions must match input length.");for(var i=0;i<e;i++){for(var s=[],h=0;h<r;h++)s.push(t[n]),n+=1;o.push(s)}return o}},function(t,e,r){"use strict";var o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var n=o(r(1));function i(t,e){var r=function(r){return n.empty(t).map(function(){return n.filled(e,r)})},o=[];return o.push(r(-1)),o.push(r(1/0)),o.push(r(0)),o}function s(t,e,r,o,n){e=Math.floor(e);var i=t[0][e],s=t[1][e];t[2][e];if(r>=s[0])return 0;for(var a=0;a<i.length;a++)if(o===i[a])return 0;return h(t,e,r,o,n)}function h(t,e,r,o,n){var i=t[0][e],s=t[1][e],h=t[2][e];if(r>=s[0])return 0;s[0]=r,i[0]=o,h[0]=n;for(var a=0,u=0;;){var l=2*a+1,f=l+1,c=t[0][0].length;if(l>=c)break;if(f>=c){if(!(s[l]>r))break;u=l}else if(s[l]>=s[f]){if(!(r<s[l]))break;u=l}else{if(!(r<s[f]))break;u=f}s[a]=s[u],i[a]=i[u],h[a]=h[u],a=u}return s[a]=r,i[a]=o,h[a]=n,1}function a(t,e,r,o){for(;2*o+1<r;){var n=2*o+1,i=n+1,s=o;if(t[s]<t[n]&&(s=n),i<r&&t[s]<t[i]&&(s=i),s===o)break;var h=t[o];t[o]=t[s],t[s]=h;var a=e[o];e[o]=e[s],e[s]=a,o=s}}e.makeHeap=i,e.rejectionSample=function(t,e,r){for(var o=n.zeros(t),i=0;i<t;i++){for(var s=!0,h=0;s;){h=n.tauRandInt(e,r);for(var a=!1,u=0;u<i;u++)if(h===o[u]){a=!0;break}a||(s=!1)}o[i]=h}return o},e.heapPush=s,e.uncheckedHeapPush=h,e.buildCandidates=function(t,e,r,o,h){for(var a=i(e,o),u=0;u<e;u++)for(var l=0;l<r;l++)if(!(t[0][u][l]<0)){var f=t[0][u][l],c=t[2][u][l],m=n.tauRand(h);s(a,u,m,f,c),s(a,f,m,u,c),t[2][u][l]=0}return a},e.deheapSort=function(t){for(var e=t[0],r=t[1],o=0;o<e.length;o++)for(var n=e[o],i=r[o],s=0;s<n.length-1;s++){var h=n.length-s-1,u=i.length-s-1,l=n[0];n[0]=n[h],n[h]=l;var f=i[0];i[0]=i[u],i[u]=f,a(i,n,u,0)}return{indices:e,weights:r}},e.smallestFlagged=function(t,e){for(var r=t[0][e],o=t[1][e],n=t[2][e],i=1/0,s=-1,h=0;h>r.length;h++)1===n[h]&&o[h]<i&&(i=o[h],s=h);return s>=0?(n[s]=0,Math.floor(r[s])):-1}},function(t,e,r){"use strict";var o,n=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},i=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var h=s(r(1)),a=function(){function t(t,e,r,o){if(this.entries=new Map,this.nRows=0,this.nCols=0,t.length!==e.length||t.length!==r.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=o[0],this.nCols=o[1];for(var n=0;n<r.length;n++){var i=t[n],s=e[n];this.checkDims(i,s);var h=this.makeKey(i,s);this.entries.set(h,{value:r[n],row:i,col:s})}}return t.prototype.makeKey=function(t,e){return t+":"+e},t.prototype.checkDims=function(t,e){if(!(t<this.nRows&&e<this.nCols))throw new Error("row and/or col specified outside of matrix dimensions")},t.prototype.set=function(t,e,r){this.checkDims(t,e);var o=this.makeKey(t,e);this.entries.has(o)?this.entries.get(o).value=r:this.entries.set(o,{value:r,row:t,col:e})},t.prototype.get=function(t,e,r){void 0===r&&(r=0),this.checkDims(t,e);var o=this.makeKey(t,e);return this.entries.has(o)?this.entries.get(o).value:r},t.prototype.getAll=function(t){void 0===t&&(t=!0);var e=[];return this.entries.forEach(function(t){e.push(t)}),t&&e.sort(function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row}),e},t.prototype.getDims=function(){return[this.nRows,this.nCols]},t.prototype.getRows=function(){return Array.from(this.entries,function(t){var e=n(t,2);e[0];return e[1].row})},t.prototype.getCols=function(){return Array.from(this.entries,function(t){var e=n(t,2);e[0];return e[1].col})},t.prototype.getValues=function(){return Array.from(this.entries,function(t){var e=n(t,2);e[0];return e[1].value})},t.prototype.forEach=function(t){this.entries.forEach(function(e){return t(e.value,e.row,e.col)})},t.prototype.map=function(e){var r=[];this.entries.forEach(function(t){r.push(e(t.value,t.row,t.col))});var o=[this.nRows,this.nCols];return new t(this.getRows(),this.getCols(),r,o)},t.prototype.toArray=function(){var t=this,e=h.empty(this.nRows).map(function(){return h.zeros(t.nCols)});return this.entries.forEach(function(t){e[t.row][t.col]=t.value}),e},t}();e.SparseMatrix=a,e.transpose=function(t){var e=[],r=[],o=[];t.forEach(function(t,n,i){e.push(n),r.push(i),o.push(t)});var n=[t.nCols,t.nRows];return new a(r,e,o,n)},e.identity=function(t){for(var e=n(t,1)[0],r=new a([],[],[],t),o=0;o<e;o++)r.set(o,o,1);return r},e.pairwiseMultiply=function(t,e){return l(t,e,function(t,e){return t*e})},e.add=function(t,e){return l(t,e,function(t,e){return t+e})},e.subtract=function(t,e){return l(t,e,function(t,e){return t-e})},e.maximum=function(t,e){return l(t,e,function(t,e){return t>e?t:e})},e.multiplyScalar=function(t,e){return t.map(function(t){return t*e})},e.eliminateZeros=function(t){for(var e=new Set,r=t.getValues(),o=t.getRows(),n=t.getCols(),i=0;i<r.length;i++)0===r[i]&&e.add(i);var s=function(t,r){return!e.has(r)},h=r.filter(s),u=o.filter(s),l=n.filter(s);return new a(u,l,h,t.getDims())},e.normalize=function(t,e){var r,o;void 0===e&&(e="l2");var n=u[e],s=new Map;t.forEach(function(t,e,r){var o=s.get(e)||[];o.push(r),s.set(e,o)});var h=new a([],[],[],t.getDims()),l=function(e){for(var r=s.get(e).sort(),o=r.map(function(r){return t.get(e,r)}),i=n(o),a=0;a<i.length;a++)h.set(e,r[a],i[a])};try{for(var f=i(s.keys()),c=f.next();!c.done;c=f.next())l(c.value)}catch(t){r={error:t}}finally{try{c&&!c.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}return h};var u=((o={}).max=function(t){for(var e=-1/0,r=0;r<t.length;r++)e=t[r]>e?t[r]:e;return t.map(function(t){return t/e})},o.l1=function(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return t.map(function(t){return t/e})},o.l2=function(t){for(var e=0,r=0;r<t.length;r++)e+=Math.pow(t[r],2);return t.map(function(t){return Math.sqrt(Math.pow(t,2)/e)})},o);function l(t,e,r){for(var o=new Set,n=[],i=[],s=[],h=function(o,h){n.push(o),i.push(h);var a=r(t.get(o,h),e.get(o,h));s.push(a)},u=t.getValues(),l=t.getRows(),f=t.getCols(),c=0;c<u.length;c++){var m=(d=l[c])+":"+(y=f[c]);o.add(m),h(d,y)}var p=e.getValues(),g=e.getRows(),w=e.getCols();for(c=0;c<p.length;c++){var d,y;m=(d=g[c])+":"+(y=w[c]);o.has(m)||h(d,y)}var v=[t.nRows,t.nCols];return new a(n,i,s,v)}e.getCSR=function(t){var e=[];t.forEach(function(t,r,o){e.push({value:t,row:r,col:o})}),e.sort(function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row});for(var r=[],o=[],n=[],i=-1,s=0;s<e.length;s++){var h=e[s],a=h.row,u=h.col,l=h.value;a!==i&&(i=a,n.push(s)),r.push(u),o.push(l)}return{indices:r,values:o,indptr:n}}},function(t,e,r){"use strict";var o=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},n=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t},i=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var h=s(r(1)),a=function(){return function(t,e,r,o){this.hyperplanes=t,this.offsets=e,this.children=r,this.indices=o}}();function u(t,e,r,o){for(var n=e,i=0;i<r.length;i++)n+=t[i]*r[i];return 0===n?h.tauRandInt(2,o):n>0?0:1}e.FlatTree=a,e.makeForest=function(t,e,r,o){var i=Math.max(10,e);return h.range(r).map(function(e,r){return function(t,e,r,o){void 0===e&&(e=30);var n=h.range(t.length);return function t(e,r,o,n,i){if(void 0===o&&(o=30),r.length>o){var s=function(t,e,r){var o=t[0].length,n=h.tauRandInt(e.length,r),i=h.tauRandInt(e.length,r);i=(i+=n===i?1:0)%e.length;for(var s=e[n],a=e[i],u=0,l=h.zeros(o),f=0;f<l.length;f++)l[f]=t[s][f]-t[a][f],u-=l[f]*(t[s][f]+t[a][f])/2;for(var c=0,m=0,p=h.zeros(e.length),f=0;f<e.length;f++){for(var g=u,w=0;w<o;w++)g+=l[w]*t[e[f]][w];0===g?(p[f]=h.tauRandInt(2,r),0===p[f]?c+=1:m+=1):g>0?(p[f]=0,c+=1):(p[f]=1,m+=1)}var d=h.zeros(c),y=h.zeros(m);for(var f in c=0,m=0,h.range(p.length))0===p[f]?(d[c]=e[f],c+=1):(y[m]=e[f],m+=1);return{indicesLeft:d,indicesRight:y,hyperplane:l,offset:u}}(e,r,i),a=s.indicesLeft,u=s.indicesRight,l=s.hyperplane,f=s.offset,c=t(e,a,o,n+1,i),m=t(e,u,o,n+1,i),p={leftChild:c,rightChild:m,isLeaf:!1,hyperplane:l,offset:f};return p}var p={indices:r,isLeaf:!0};return p}(t,n,e,r,o)}(t,i,r,o)}).map(function(t){return function(t,e){var r=function t(e){return e.isLeaf?1:1+t(e.leftChild)+t(e.rightChild)}(t),o=function t(e){return e.isLeaf?1:t(e.leftChild)+t(e.rightChild)}(t),i=h.range(r).map(function(){return h.zeros(t.hyperplane?t.hyperplane.length:0)}),s=h.zeros(r),u=h.range(r).map(function(){return[-1,-1]}),l=h.range(o).map(function(){return h.range(e).map(function(){return-1})});return function t(e,r,o,i,s,h,a){var u;if(e.isLeaf)return i[h][0]=-a,(u=s[a]).splice.apply(u,n([0,e.indices.length],e.indices)),{nodeNum:h,leafNum:a+=1};r[h]=e.hyperplane,o[h]=e.offset,i[h][0]=h+1;var l=h,f=t(e.leftChild,r,o,i,s,h+1,a);return h=f.nodeNum,a=f.leafNum,i[l][1]=h+1,{nodeNum:(f=t(e.rightChild,r,o,i,s,h+1,a)).nodeNum,leafNum:f.leafNum}}(t,i,s,u,l,0,0),new a(i,s,u,l)}(t,i)})},e.makeLeafArray=function(t){var e,r;if(t.length>0){var o=[];try{for(var s=i(t),h=s.next();!h.done;h=s.next()){var a=h.value;o.push.apply(o,n(a.indices))}}catch(t){e={error:t}}finally{try{h&&!h.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return o}return[[-1]]},e.searchFlatTree=function(t,e,r){for(var o=0;e.children[o][0]>0;)o=0===u(e.hyperplanes[o],e.offsets[o],t,r)?e.children[o][0]:e.children[o][1];var n=-1*e.children[o][0];return e.indices[n]}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r(6);e.UMAP=o.UMAP},function(t,e,r){"use strict";var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(n,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function h(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,h)}a((o=o.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function h(i){return function(h){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,h])}}},i=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},s=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t},h=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=h(r(2)),l=h(r(3)),f=h(r(7)),c=h(r(4)),m=h(r(1)),p=a(r(8)),g=function(){function t(t){void 0===t&&(t={});var e=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=w,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new d;var r=function(r){void 0!==t[r]&&(e[r]=t[r])};r("distanceFn"),r("learningRate"),r("localConnectivity"),r("minDist"),r("nComponents"),r("nEpochs"),r("nNeighbors"),r("negativeSampleRate"),r("random"),r("repulsionStrength"),r("setOpMixRatio"),r("spread"),r("transformQueueSize")}return t.prototype.fit=function(t){return this.initializeFit(t),this.optimizeLayout(),this.embedding},t.prototype.fitAsync=function(t,e){return void 0===e&&(e=function(){return!0}),o(this,void 0,void 0,function(){return n(this,function(r){switch(r.label){case 0:return this.initializeFit(t),[4,this.optimizeLayoutAsync(e)];case 1:return r.sent(),[2,this.embedding]}})})},t.prototype.setSupervisedProjection=function(t,e){void 0===e&&(e={}),this.Y=t,this.targetMetric=e.targetMetric||this.targetMetric,this.targetWeight=e.targetWeight||this.targetWeight,this.targetNNeighbors=e.targetNNeighbors||this.targetNNeighbors},t.prototype.setPrecomputedKNN=function(t,e){this.knnIndices=t,this.knnDistances=e},t.prototype.initializeFit=function(t){if(t.length<=this.nNeighbors)throw new Error("Not enough data points ("+t.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===t&&this.isInitialized)return this.getNEpochs();if(this.X=t,!this.knnIndices&&!this.knnDistances){var e=this.nearestNeighbors(t);this.knnIndices=e.knnIndices,this.knnDistances=e.knnDistances}this.graph=this.fuzzySimplicialSet(t,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(t),this.processGraphForSupervisedProjection();var r=this.initializeSimplicialSetEmbedding(),o=r.head,n=r.tail,i=r.epochsPerSample;return this.optimizationState.head=o,this.optimizationState.tail=n,this.optimizationState.epochsPerSample=i,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},t.prototype.makeSearchFns=function(){var t=f.makeInitializations(this.distanceFn),e=t.initFromTree,r=t.initFromRandom;this.initFromTree=e,this.initFromRandom=r,this.search=f.makeInitializedNNSearch(this.distanceFn)},t.prototype.makeSearchGraph=function(t){for(var e=this.knnIndices,r=this.knnDistances,o=[t.length,t.length],n=new l.SparseMatrix([],[],[],o),i=0;i<e.length;i++)for(var s=e[i],h=r[i],a=0;a<s.length;a++){var u=s[a],f=h[a];f>0&&n.set(i,u,f)}var c=l.transpose(n);return l.maximum(n,c)},t.prototype.transform=function(t){var e=this,r=this.X;if(void 0===r||0===r.length)throw new Error("No data has been fit.");var o=Math.floor(this.nNeighbors*this.transformQueueSize);o=Math.min(r.length,o);var n=f.initializeSearch(this.rpForest,r,t,o,this.initFromRandom,this.initFromTree,this.random),i=this.search(r,this.searchGraph,n,t),s=u.deheapSort(i),h=s.indices,a=s.weights;h=h.map(function(t){return t.slice(0,e.nNeighbors)}),a=a.map(function(t){return t.slice(0,e.nNeighbors)});var c=Math.max(0,this.localConnectivity-1),p=this.smoothKNNDistance(a,this.nNeighbors,c),g=p.sigmas,w=p.rhos,d=this.computeMembershipStrengths(h,a,g,w),y=d.rows,v=d.cols,b=d.vals,M=[t.length,r.length],S=new l.SparseMatrix(y,v,b,M),E=l.normalize(S,"l1"),R=l.getCSR(E),k=t.length,N=x(m.reshape2d(R.indices,k,this.nNeighbors),m.reshape2d(R.values,k,this.nNeighbors),this.embedding),z=this.nEpochs?this.nEpochs/3:S.nRows<=1e4?100:30,A=S.getValues().reduce(function(t,e){return e>t?e:t},0);S=S.map(function(t){return t<A/z?0:t}),S=l.eliminateZeros(S);var _=this.makeEpochsPerSample(S.getValues(),z),P=S.getRows(),C=S.getCols();return this.assignOptimizationStateParameters({headEmbedding:N,tailEmbedding:this.embedding,head:P,tail:C,currentEpoch:0,nEpochs:z,nVertices:S.getDims()[1],epochsPerSample:_}),this.prepareForOptimizationLoop(),this.optimizeLayout()},t.prototype.processGraphForSupervisedProjection=function(){var t=this.Y,e=this.X;if(t){if(t.length!==e.length)throw new Error("Length of X and y must be equal");if("categorical"===this.targetMetric){var r=this.targetWeight<1?1/(1-this.targetWeight)*2.5:1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,t,r)}}},t.prototype.step=function(){var t=this.optimizationState.currentEpoch;return t<this.getNEpochs()&&this.optimizeLayoutStep(t),this.optimizationState.currentEpoch},t.prototype.getEmbedding=function(){return this.embedding},t.prototype.nearestNeighbors=function(t){var e,r=this.distanceFn,o=this.nNeighbors,n=f.makeNNDescent(r,this.random),i=5+Math.floor(.5===(e=Math.pow(t.length,.5)/20)?0:Math.round(e)),s=Math.max(5,Math.floor(Math.round(function(t){return Math.log(t)/Math.log(2)}(t.length))));this.rpForest=c.makeForest(t,o,i,this.random);var h=n(t,c.makeLeafArray(this.rpForest),o,s);return{knnIndices:h.indices,knnDistances:h.weights}},t.prototype.fuzzySimplicialSet=function(t,e,r){void 0===r&&(r=1);var o=this.knnIndices,n=void 0===o?[]:o,i=this.knnDistances,s=void 0===i?[]:i,h=this.localConnectivity,a=this.smoothKNNDistance(s,e,h),u=a.sigmas,f=a.rhos,c=this.computeMembershipStrengths(n,s,u,f),m=c.rows,p=c.cols,g=c.vals,w=[t.length,t.length],d=new l.SparseMatrix(m,p,g,w),y=l.transpose(d),v=l.pairwiseMultiply(d,y),b=l.subtract(l.add(d,y),v),M=l.multiplyScalar(b,r),S=l.multiplyScalar(v,1-r);return l.add(M,S)},t.prototype.categoricalSimplicialSetIntersection=function(t,e,r,o){void 0===o&&(o=1);var n=M(t,e,o,r);return S(n=l.eliminateZeros(n))},t.prototype.smoothKNNDistance=function(t,e,r,o,n){void 0===r&&(r=1),void 0===o&&(o=64),void 0===n&&(n=1);for(var i=Math.log(e)/Math.log(2)*n,s=m.zeros(t.length),h=m.zeros(t.length),a=0;a<t.length;a++){var u=0,l=1/0,f=1,c=t[a],p=c.filter(function(t){return t>0});if(p.length>=r){var g=Math.floor(r),w=r-g;g>0?(s[a]=p[g-1],w>1e-5&&(s[a]+=w*(p[g]-p[g-1]))):s[a]=w*p[0]}else p.length>0&&(s[a]=m.max(p));for(var d=0;d<o;d++){for(var y=0,v=1;v<t[a].length;v++){var b=t[a][v]-s[a];y+=b>0?Math.exp(-b/f):1}if(Math.abs(y-i)<1e-5)break;y>i?f=(u+(l=f))/2:(u=f,l===1/0?f*=2:f=(u+l)/2)}if(h[a]=f,s[a]>0){var M=m.mean(c);h[a]<.001*M&&(h[a]=.001*M)}else{var S=m.mean(t.map(m.mean));h[a]<.001*S&&(h[a]=.001*S)}}return{sigmas:h,rhos:s}},t.prototype.computeMembershipStrengths=function(t,e,r,o){for(var n=t.length,i=t[0].length,s=m.zeros(n*i),h=m.zeros(n*i),a=m.zeros(n*i),u=0;u<n;u++)for(var l=0;l<i;l++){var f=0;-1!==t[u][l]&&(f=t[u][l]===u?0:e[u][l]-o[u]<=0?1:Math.exp(-(e[u][l]-o[u])/r[u]),s[u*i+l]=u,h[u*i+l]=t[u][l],a[u*i+l]=f)}return{rows:s,cols:h,vals:a}},t.prototype.initializeSimplicialSetEmbedding=function(){for(var t=this,e=this.getNEpochs(),r=this.nComponents,o=this.graph.getValues(),n=0,i=0;i<o.length;i++){var s=o[i];n<o[i]&&(n=s)}var h=this.graph.map(function(t){return t<n/e?0:t});this.embedding=m.zeros(h.nRows).map(function(){return m.zeros(r).map(function(){return 20*m.tauRand(t.random)-10})});var a=[],u=[],l=[],f=h.getAll();for(i=0;i<f.length;i++){var c=f[i];c.value&&(a.push(c.value),l.push(c.row),u.push(c.col))}return{head:u,tail:l,epochsPerSample:this.makeEpochsPerSample(a,e)}},t.prototype.makeEpochsPerSample=function(t,e){var r=m.filled(t.length,-1),o=m.max(t),n=t.map(function(t){return t/o*e});return n.forEach(function(t,o){t>0&&(r[o]=e/n[o])}),r},t.prototype.assignOptimizationStateParameters=function(t){Object.assign(this.optimizationState,t)},t.prototype.prepareForOptimizationLoop=function(){var t=this.repulsionStrength,e=this.learningRate,r=this.negativeSampleRate,o=this.optimizationState,n=o.epochsPerSample,i=o.headEmbedding,h=o.tailEmbedding,a=i[0].length,u=i.length===h.length,l=n.map(function(t){return t/r}),f=s(l),c=s(n);this.assignOptimizationStateParameters({epochOfNextSample:c,epochOfNextNegativeSample:f,epochsPerNegativeSample:l,moveOther:u,initialAlpha:e,alpha:e,gamma:t,dim:a})},t.prototype.initializeOptimization=function(){var t=this.embedding,e=this.embedding,r=this.optimizationState,o=r.head,n=r.tail,i=r.epochsPerSample,s=this.getNEpochs(),h=this.graph.nCols,a=b(this.spread,this.minDist),u=a.a,l=a.b;this.assignOptimizationStateParameters({headEmbedding:t,tailEmbedding:e,head:o,tail:n,epochsPerSample:i,a:u,b:l,nEpochs:s,nVertices:h})},t.prototype.optimizeLayoutStep=function(t){for(var e=this.optimizationState,r=e.head,o=e.tail,n=e.headEmbedding,i=e.tailEmbedding,s=e.epochsPerSample,h=e.epochOfNextSample,a=e.epochOfNextNegativeSample,u=e.epochsPerNegativeSample,l=e.moveOther,f=e.initialAlpha,c=e.alpha,p=e.gamma,g=e.a,w=e.b,d=e.dim,b=e.nEpochs,M=e.nVertices,S=0;S<s.length;S++)if(!(h[S]>t)){var x=r[S],E=o[S],R=n[x],k=i[E],N=v(R,k),z=0;N>0&&(z=-2*g*w*Math.pow(N,w-1),z/=g*Math.pow(N,w)+1);for(var A=0;A<d;A++){var _=y(z*(R[A]-k[A]),4);R[A]+=_*c,l&&(k[A]+=-_*c)}h[S]+=s[S];for(var P=Math.floor((t-a[S])/u[S]),C=0;C<P;C++){var F=m.tauRandInt(M,this.random),T=i[F],j=v(R,T),I=0;if(j>0)I=2*p*w,I/=(.001+j)*(g*Math.pow(j,w)+1);else if(x===F)continue;for(A=0;A<d;A++){_=4;I>0&&(_=y(I*(R[A]-T[A]),4)),R[A]+=_*c}}a[S]+=P*u[S]}return e.alpha=f*(1-t/b),e.currentEpoch+=1,n},t.prototype.optimizeLayoutAsync=function(t){var e=this;return void 0===t&&(t=function(){return!0}),new Promise(function(r,i){var s=function(){return o(e,void 0,void 0,function(){var e,o,h,a,u,l;return n(this,function(n){try{if(e=this.optimizationState,o=e.nEpochs,h=e.currentEpoch,this.embedding=this.optimizeLayoutStep(h),a=this.optimizationState.currentEpoch,u=!1===t(a),l=a===o,u||l)return[2,r(l)];setTimeout(function(){return s()},0)}catch(t){i(t)}return[2]})})};setTimeout(function(){return s()},0)})},t.prototype.optimizeLayout=function(t){void 0===t&&(t=function(){return!0});for(var e=!1,r=[];!e;){var o=this.optimizationState,n=o.nEpochs,i=o.currentEpoch;r=this.optimizeLayoutStep(i);var s=this.optimizationState.currentEpoch,h=!1===t(s);e=s===n||h}return r},t.prototype.getNEpochs=function(){var t=this.graph;if(this.nEpochs>0)return this.nEpochs;var e=t.nRows;return e<=2500?500:e<=5e3?400:e<=7500?300:200},t}();function w(t,e){for(var r=0,o=0;o<t.length;o++)r+=Math.pow(t[o]-e[o],2);return Math.sqrt(r)}e.UMAP=g,e.euclidean=w,e.cosine=function(t,e){for(var r=0,o=0,n=0,i=0;i<t.length;i++)r+=t[i]*e[i],o+=Math.pow(t[i],2),n+=Math.pow(e[i],2);return 0===o&&0===n?0:0===o||0===n?1:1-r/Math.sqrt(o*n)};var d=function(){return function(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}}();function y(t,e){return t>e?e:t<-e?-e:t}function v(t,e){for(var r=0,o=0;o<t.length;o++)r+=Math.pow(t[o]-e[o],2);return r}function b(t,e){var r=m.linear(0,3*t,300).map(function(t){return t<e?1:t}),o=m.zeros(r.length).map(function(o,n){return r[n]>=e?Math.exp(-(r[n]-e)/t):o}),n={x:r,y:o},s={damping:1.5,initialValues:[.5,.5],gradientDifference:.1,maxIterations:100,errorTolerance:.01},h=p.default(n,function(t){var e=i(t,2),r=e[0],o=e[1];return function(t){return 1/(1+r*Math.pow(t,2*o))}},s).parameterValues,a=i(h,2);return{a:a[0],b:a[1]}}function M(t,e,r,o){return void 0===r&&(r=1),void 0===o&&(o=5),t.map(function(t,n,i){return-1===e[n]||-1===e[i]?t*Math.exp(-r):e[n]!==e[i]?t*Math.exp(-o):t})}function S(t){t=l.normalize(t,"max");var e=l.transpose(t),r=l.pairwiseMultiply(e,t);return t=l.add(t,l.subtract(e,r)),l.eliminateZeros(t)}function x(t,e,r){for(var o=m.zeros(t.length).map(function(t){return m.zeros(r[0].length)}),n=0;n<t.length;n++)for(var i=0;i<t[0].length;i++)for(var s=0;s<r[0].length;s++){var h=t[n][i];o[n][s]+=e[n][i]*r[h][s]}return o}e.findABParams=b,e.fastIntersection=M,e.resetLocalConnectivity=S,e.initTransform=x},function(t,e,r){"use strict";var o=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(2)),s=n(r(3)),h=n(r(4)),a=n(r(1));e.makeNNDescent=function(t,e){return function(r,o,n,s,h,u,l,f){void 0===s&&(s=10),void 0===h&&(h=50),void 0===u&&(u=.001),void 0===l&&(l=.5),void 0===f&&(f=!0);for(var c=r.length,m=i.makeHeap(r.length,n),p=0;p<r.length;p++)for(var g=i.rejectionSample(n,r.length,e),w=0;w<g.length;w++){var d=t(r[p],r[g[w]]);i.heapPush(m,p,d,g[w],1),i.heapPush(m,g[w],d,p,1)}if(f)for(var y=0;y<o.length;y++)for(p=0;p<o[y].length&&!(o[y][p]<0);p++)for(w=p+1;w<o[y].length&&!(o[y][w]<0);w++)d=t(r[o[y][p]],r[o[y][w]]),i.heapPush(m,o[y][p],d,o[y][w],1),i.heapPush(m,o[y][w],d,o[y][p],1);for(y=0;y<s;y++){var v=i.buildCandidates(m,c,n,h,e),b=0;for(p=0;p<c;p++)for(w=0;w<h;w++){var M=Math.floor(v[0][p][w]);if(!(M<0||a.tauRand(e)<l))for(var S=0;S<h;S++){var x=Math.floor(v[0][p][S]),E=v[2][p][w],R=v[2][p][S];x<0||!E&&!R||(d=t(r[M],r[x]),b+=i.heapPush(m,M,d,x,1),b+=i.heapPush(m,x,d,M,1))}}if(b<=u*n*r.length)break}return i.deheapSort(m)}},e.makeInitializations=function(t){return{initFromRandom:function(e,r,o,n,s){for(var h=0;h<o.length;h++)for(var u=a.rejectionSample(e,r.length,s),l=0;l<u.length;l++)if(!(u[l]<0)){var f=t(r[u[l]],o[h]);i.heapPush(n,h,f,u[l],1)}},initFromTree:function(e,r,o,n,s){for(var a=0;a<o.length;a++)for(var u=h.searchFlatTree(o[a],e,s),l=0;l<u.length;l++){if(u[l]<0)return;var f=t(r[u[l]],o[a]);i.heapPush(n,a,f,u[l],1)}}}},e.makeInitializedNNSearch=function(t){return function(e,r,n,h){for(var a,u,l=s.getCSR(r),f=l.indices,c=l.indptr,m=0;m<h.length;m++)for(var p=new Set(n[0][m]);;){var g=i.smallestFlagged(n,m);if(-1===g)break;var w=f.slice(c[g],c[g+1]);try{for(var d=o(w),y=d.next();!y.done;y=d.next()){var v=y.value;if(v!==g&&-1!==v&&!p.has(v)){var b=t(e[v],h[m]);i.uncheckedHeapPush(n,m,b,v,1),p.add(v)}}}catch(t){a={error:t}}finally{try{y&&!y.done&&(u=d.return)&&u.call(d)}finally{if(a)throw a.error}}}return n}},e.initializeSearch=function(t,e,r,n,s,h,a){var u,l,f=i.makeHeap(r.length,n);if(s(n,e,r,f,a),t)try{for(var c=o(t),m=c.next();!m.done;m=c.next())h(m.value,e,r,f,a)}catch(t){u={error:t}}finally{try{m&&!m.done&&(l=c.return)&&l.call(c)}finally{if(u)throw u.error}}return f}},function(t,e,r){"use strict";function o(t,e,r){var o=0;const n=r(e);for(var i=0;i<t.x.length;i++)o+=Math.abs(t.y[i]-n(t.x[i]));return o}r.r(e);var n=r(0),i=r.n(n);var s=function(t){if(!i()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return e};var h=function(t){if(!i()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e};var a=function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!i()(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!i()(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var o=h(t),n=s(t);if(o===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var a=r.min,u=void 0===a?r.autoMinMax?o:0:a,l=r.max,f=void 0===l?r.autoMinMax?n:1:l;if(u>=f)throw new RangeError("min option must be smaller than max option");for(var c=(f-u)/(n-o),m=0;m<t.length;m++)e[m]=(t[m]-o)*c+u;return e};function u(t,e,r){let o=r?t.rows:t.rows-1;if(e<0||e>o)throw new RangeError("Row index out of range")}function l(t,e,r){let o=r?t.columns:t.columns-1;if(e<0||e>o)throw new RangeError("Column index out of range")}function f(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function c(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function m(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function p(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function g(t,e,r,o,n){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(d("startRow",e),d("endRow",r),d("startColumn",o),d("endColumn",n),e>r||o>n||e<0||e>=t.rows||r<0||r>=t.rows||o<0||o>=t.columns||n<0||n>=t.columns)throw new RangeError("Submatrix indices are out of range")}function w(t,e=0){let r=[];for(let o=0;o<t;o++)r.push(e);return r}function d(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}const y=15,v=10,b=8;function M(t){const e=String(t);if(e.length<=b)return e.padEnd(b," ");const r=t.toPrecision(b-2);if(r.length<=b)return r;const o=t.toExponential(b-2),n=o.indexOf("e"),i=o.substring(n);return o.substring(0,b-i.length)+i}class S{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let o=new E(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)o.set(n,t,r[n*e+t]);return o}static rowVector(t){let e=new E(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new E(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new E(t,e)}static ones(t,e){return new E(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:o=Math.random}=r;let n=new E(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,o());return n}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:o=0,max:n=1e3,random:i=Math.random}=r;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(o>=n)throw new RangeError("min must be smaller than max");let s=n-o,h=new E(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=o+Math.round(i()*s);h.set(r,t,e)}return h}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let o=Math.min(t,e),n=this.zeros(t,e);for(let t=0;t<o;t++)n.set(t,t,r);return n}static diag(t,e,r){let o=t.length;void 0===e&&(e=o),void 0===r&&(r=e);let n=Math.min(o,e,r),i=this.zeros(e,r);for(let e=0;e<n;e++)i.set(e,e,t[e]);return i}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,n=new E(r,o);for(let i=0;i<r;i++)for(let r=0;r<o;r++)n.set(i,r,Math.min(t.get(i,r),e.get(i,r)));return n}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,n=new this(r,o);for(let i=0;i<r;i++)for(let r=0;r<o;r++)n.set(i,r,Math.max(t.get(i,r),e.get(i,r)));return n}static checkMatrix(t){return S.isMatrix(t)?t:new E(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,o=!0,n=!1;for(;t<this.rows&&o;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(o=!1,n=!0);t++}return o}isReducedEchelonForm(){let t=0,e=0,r=-1,o=!0,n=!1;for(;t<this.rows&&o;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(o=!1,n=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(o=!1);t++}return o}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let o=e;for(let n=e;n<t.rows;n++)t.get(n,r)>t.get(o,r)&&(o=n);if(0===t.get(o,r))r++;else{t.swapRows(e,o);let n=t.get(e,r);for(let o=r;o<t.columns;o++)t.set(e,o,t.get(e,o)/n);for(let o=e+1;o<t.rows;o++){let n=t.get(o,r)/t.get(e,r);t.set(o,r,0);for(let i=r+1;i<t.columns;i++)t.set(o,i,t.get(o,i)-t.get(e,i)*n)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,o=r-1;for(;o>=0;)if(0===t.maxRow(o))o--;else{let n=0,i=!1;for(;n<r&&!1===i;)1===t.get(o,n)?i=!0:n++;for(let r=0;r<o;r++){let i=t.get(r,n);for(let s=n;s<e;s++){let e=t.get(r,s)-i*t.get(o,s);t.set(r,s,e)}}o--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let o=new E(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)o.setSubMatrix(this,this.rows*t,this.columns*e);return o}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){u(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return E.rowVector(this.getRow(t))}setRow(t,e){u(this,t),e=f(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){u(this,t),u(this,e);for(let r=0;r<this.columns;r++){let o=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,o)}return this}getColumn(t){l(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return E.columnVector(this.getColumn(t))}setColumn(t,e){l(this,t),e=c(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){l(this,t),l(this,e);for(let r=0;r<this.rows;r++){let o=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,o)}return this}addRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){u(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){l(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}min(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}maxRow(t){u(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){u(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),r[1]=o);return r}minRow(t){u(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){u(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),r[1]=o);return r}maxColumn(t){l(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){l(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t),r[0]=o);return r}minColumn(t){l(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){l(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t),r[0]=o);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError(`unknown norm type: ${t}`)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){S.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o];return r}mmul(t){t=E.checkMatrix(t);let e=this.rows,r=this.columns,o=t.columns,n=new E(e,o),i=new Float64Array(r);for(let s=0;s<o;s++){for(let e=0;e<r;e++)i[e]=t.get(e,s);for(let t=0;t<e;t++){let e=0;for(let o=0;o<r;o++)e+=this.get(t,o)*i[o];n.set(t,s,e)}}return n}strassen2x2(t){t=E.checkMatrix(t);let e=new E(2,2);const r=this.get(0,0),o=t.get(0,0),n=this.get(0,1),i=t.get(0,1),s=this.get(1,0),h=t.get(1,0),a=this.get(1,1),u=t.get(1,1),l=(r+a)*(o+u),f=(s+a)*o,c=r*(i-u),m=a*(h-o),p=(r+n)*u,g=l+m-p+(n-a)*(h+u),w=c+p,d=f+m,y=l-f+c+(s-r)*(o+i);return e.set(0,0,g),e.set(0,1,w),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=E.checkMatrix(t);let e=new E(3,3);const r=this.get(0,0),o=this.get(0,1),n=this.get(0,2),i=this.get(1,0),s=this.get(1,1),h=this.get(1,2),a=this.get(2,0),u=this.get(2,1),l=this.get(2,2),f=t.get(0,0),c=t.get(0,1),m=t.get(0,2),p=t.get(1,0),g=t.get(1,1),w=t.get(1,2),d=t.get(2,0),y=t.get(2,1),v=t.get(2,2),b=(r-i)*(-c+g),M=(-r+i+s)*(f-c+g),S=(i+s)*(-f+c),x=r*f,R=(-r+a+u)*(f-m+w),k=(-r+a)*(m-w),N=(a+u)*(-f+m),z=(-n+u+l)*(g+d-y),A=(n-l)*(g-y),_=n*d,P=(u+l)*(-d+y),C=(-n+s+h)*(w+d-v),F=(n-h)*(w-v),T=(s+h)*(-d+v),j=x+_+o*p,I=(r+o+n-i-s-u-l)*g+M+S+x+z+_+P,V=x+R+N+(r+o+n-s-h-a-u)*w+_+C+T,O=b+s*(-f+c+p-g-w-d+v)+M+x+_+C+F,D=b+M+S+x+h*y,q=_+C+F+T+i*m,L=x+R+k+u*(-f+m+p-g-w-d+y)+z+A+_,$=z+A+_+P+a*c,U=x+R+k+N+l*v;return e.set(0,0,j),e.set(0,1,I),e.set(0,2,V),e.set(1,0,O),e.set(1,1,D),e.set(1,2,q),e.set(2,0,L),e.set(2,1,$),e.set(2,2,U),e}mmulStrassen(t){t=E.checkMatrix(t);let e=this.clone(),r=e.rows,o=e.columns,n=t.rows,i=t.columns;function s(t,e,r){let o=t.rows,n=t.columns;if(o===e&&n===r)return t;{let o=S.zeros(e,r);return o=o.setSubMatrix(t,0,0)}}o!==n&&console.warn(`Multiplying ${r} x ${o} and ${n} x ${i} matrix: dimensions do not match.`);let h=Math.max(r,n),a=Math.max(o,i);return function t(e,r,o,n){if(o<=512||n<=512)return e.mmul(r);o%2==1&&n%2==1?(e=s(e,o+1,n+1),r=s(r,o+1,n+1)):o%2==1?(e=s(e,o+1,n),r=s(r,o+1,n)):n%2==1&&(e=s(e,o,n+1),r=s(r,o,n+1));let i=parseInt(e.rows/2,10),h=parseInt(e.columns/2,10),a=e.subMatrix(0,i-1,0,h-1),u=r.subMatrix(0,i-1,0,h-1),l=e.subMatrix(0,i-1,h,e.columns-1),f=r.subMatrix(0,i-1,h,r.columns-1),c=e.subMatrix(i,e.rows-1,0,h-1),m=r.subMatrix(i,r.rows-1,0,h-1),p=e.subMatrix(i,e.rows-1,h,e.columns-1),g=r.subMatrix(i,r.rows-1,h,r.columns-1),w=t(S.add(a,p),S.add(u,g),i,h),d=t(S.add(c,p),u,i,h),y=t(a,S.sub(f,g),i,h),v=t(p,S.sub(m,u),i,h),b=t(S.add(a,l),g,i,h),M=t(S.sub(c,a),S.add(u,f),i,h),x=t(S.sub(l,p),S.add(m,g),i,h),E=S.add(w,v);E.sub(b),E.add(x);let R=S.add(y,b),k=S.add(d,v),N=S.sub(w,d);N.add(y),N.add(M);let z=S.zeros(2*E.rows,2*E.columns);return(z=(z=(z=(z=z.setSubMatrix(E,0,0)).setSubMatrix(R,E.rows,0)).setSubMatrix(k,0,E.columns)).setSubMatrix(N,E.rows,E.columns)).subMatrix(0,o-1,0,n-1)}(e=s(e,h,a),t=s(t,h,a),h,a)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new E(this.rows,this.columns);for(let t=0;t<this.rows;t++){const n=this.getRow(t);a(n,{min:e,max:r,output:n}),o.setRow(t,n)}return o}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new E(this.rows,this.columns);for(let t=0;t<this.columns;t++){const n=this.getColumn(t);a(n,{min:e,max:r,output:n}),o.setColumn(t,n)}return o}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),o=this.get(e,this.columns-1-r);this.set(e,r,o),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),o=this.get(this.rows-1-r,e);this.set(r,e,o),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=E.checkMatrix(t);let e=this.rows,r=this.columns,o=t.rows,n=t.columns,i=new E(e*o,r*n);for(let s=0;s<e;s++)for(let e=0;e<r;e++)for(let r=0;r<o;r++)for(let h=0;h<n;h++)i.set(o*s+r,n*e+h,this.get(s,e)*t.get(r,h));return i}transpose(){let t=new E(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=x){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=x){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,o){g(this,t,e,r,o);let n=new E(e-t+1,o-r+1);for(let i=t;i<=e;i++)for(let e=r;e<=o;e++)n.set(i-t,e-r,this.get(i,e));return n}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let o=new E(t.length,r-e+1);for(let n=0;n<t.length;n++)for(let i=e;i<=r;i++){if(t[n]<0||t[n]>=this.rows)throw new RangeError(`Row index out of range: ${t[n]}`);o.set(n,i-e,this.get(t[n],i))}return o}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let o=new E(r-e+1,t.length);for(let n=0;n<t.length;n++)for(let i=e;i<=r;i++){if(t[n]<0||t[n]>=this.columns)throw new RangeError(`Column index out of range: ${t[n]}`);o.set(i-e,n,this.get(i,t[n]))}return o}setSubMatrix(t,e,r){g(this,e,e+(t=E.checkMatrix(t)).rows-1,r,r+t.columns-1);for(let o=0;o<t.rows;o++)for(let n=0;n<t.columns;n++)this.set(e+o,r+n,t.get(o,n));return this}selection(t,e){let r=function(t,e,r){return{row:m(t,e),column:p(t,r)}}(this,t,e),o=new E(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let n=0;n<r.column.length;n++){let i=r.column[n];o.set(t,n,this.get(e,i))}}return o}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new E(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return function(t){let e=w(t.rows);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]+=t.get(r,o);return e}(this);case"column":return function(t){let e=w(t.columns);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]+=t.get(r,o);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e+=t.get(r,o);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=w(t.rows,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]*=t.get(r,o);return e}(this);case"column":return function(t){let e=w(t.columns,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]*=t.get(r,o);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e*=t.get(r,o);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:o=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,n=t.columns,i=[];for(let s=0;s<o;s++){let o=0,h=0,a=0;for(let e=0;e<n;e++)o+=a=t.get(s,e)-r[s],h+=a*a;e?i.push((h-o*o/n)/(n-1)):i.push((h-o*o/n)/n)}return i}(this,r,o);case"column":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,n=t.columns,i=[];for(let s=0;s<n;s++){let n=0,h=0,a=0;for(let e=0;e<o;e++)n+=a=t.get(e,s)-r[s],h+=a*a;e?i.push((h-n*n/o)/(o-1)):i.push((h-n*n/o)/o)}return i}(this,r,o);case void 0:if("number"!=typeof o)throw new TypeError("mean must be a number");return function(t,e,r){const o=t.rows,n=t.columns,i=o*n;let s=0,h=0,a=0;for(let e=0;e<o;e++)for(let o=0;o<n;o++)s+=a=t.get(e,o)-r,h+=a*a;return e?(h-s*s/i)/(i-1):(h-s*s/i)/i}(this,r,o);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[r])}(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[o])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let o=0;for(let e=0;e<t.columns;e++)o+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let o=0;for(let e=0;e<t.rows;e++)o+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[o])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let o=0;o<t.columns;o++)for(let n=0;n<t.rows;n++)r+=Math.pow(t.get(n,o),2)/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}}function x(t,e){return t-e}S.prototype.klass="Matrix","undefined"!=typeof Symbol&&(S.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){const t=" ".repeat(2),e=" ".repeat(4);return`${this.constructor.name} {\n${t}[\n${e}${function(t,e){const{rows:r,columns:o}=t,n=Math.min(r,y),i=Math.min(o,v),s=[];for(let e=0;e<n;e++){let r=[];for(let o=0;o<i;o++)r.push(M(t.get(e,o)));s.push(`${r.join(" ")}`)}return i!==o&&(s[s.length-1]+=` ... ${o-v} more columns`),n!==r&&s.push(`... ${r-y} more rows`),s.join(`\n${e}`)}(this,e)}\n${t}]\n${t}rows: ${this.rows}\n${t}columns: ${this.columns}\n}`}),S.random=S.rand,S.randomInt=S.randInt,S.diagonal=S.diag,S.prototype.diagonal=S.prototype.diag,S.identity=S.eye,S.prototype.negate=S.prototype.neg,S.prototype.tensorProduct=S.prototype.kroneckerProduct;class E extends S{constructor(t,e){if(super(),E.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(this.data=[],!(Number.isInteger(e)&&e>0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if(t=r.length,"number"!=typeof(e=r[0].length)||0===e)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<t;o++){if(r[o].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[o]))}}}return this.rows=t,this.columns=e,this}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){if(u(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),u(this,t,!0),e=Float64Array.from(f(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){if(l(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let o=0;o<t;o++)r[o]=this.data[e][o];for(let o=t+1;o<this.columns;o++)r[o-1]=this.data[e][o];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),l(this,t,!0),e=c(this,e);for(let r=0;r<this.rows;r++){const o=new Float64Array(this.columns+1);let n=0;for(;n<t;n++)o[n]=this.data[r][n];for(o[n++]=e[r];n<this.columns+1;n++)o[n]=this.data[r][n-1];this.data[r]=o}return this.columns+=1,this}}var R,k;k=E,(R=S).prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},R.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},R.prototype.addM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},R.add=function(t,e){return new k(t).add(e)},R.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},R.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},R.prototype.subM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},R.sub=function(t,e){return new k(t).sub(e)},R.prototype.subtract=R.prototype.sub,R.prototype.subtractS=R.prototype.subS,R.prototype.subtractM=R.prototype.subM,R.subtract=R.sub,R.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},R.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},R.prototype.mulM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},R.mul=function(t,e){return new k(t).mul(e)},R.prototype.multiply=R.prototype.mul,R.prototype.multiplyS=R.prototype.mulS,R.prototype.multiplyM=R.prototype.mulM,R.multiply=R.mul,R.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},R.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},R.prototype.divM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},R.div=function(t,e){return new k(t).div(e)},R.prototype.divide=R.prototype.div,R.prototype.divideS=R.prototype.divS,R.prototype.divideM=R.prototype.divM,R.divide=R.div,R.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},R.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},R.prototype.modM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},R.mod=function(t,e){return new k(t).mod(e)},R.prototype.modulus=R.prototype.mod,R.prototype.modulusS=R.prototype.modS,R.prototype.modulusM=R.prototype.modM,R.modulus=R.mod,R.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},R.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},R.prototype.andM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},R.and=function(t,e){return new k(t).and(e)},R.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},R.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},R.prototype.orM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},R.or=function(t,e){return new k(t).or(e)},R.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},R.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},R.prototype.xorM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},R.xor=function(t,e){return new k(t).xor(e)},R.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},R.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},R.prototype.leftShiftM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},R.leftShift=function(t,e){return new k(t).leftShift(e)},R.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},R.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},R.prototype.signPropagatingRightShiftM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},R.signPropagatingRightShift=function(t,e){return new k(t).signPropagatingRightShift(e)},R.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},R.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},R.prototype.rightShiftM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},R.rightShift=function(t,e){return new k(t).rightShift(e)},R.prototype.zeroFillRightShift=R.prototype.rightShift,R.prototype.zeroFillRightShiftS=R.prototype.rightShiftS,R.prototype.zeroFillRightShiftM=R.prototype.rightShiftM,R.zeroFillRightShift=R.rightShift,R.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},R.not=function(t){return new k(t).not()},R.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},R.abs=function(t){return new k(t).abs()},R.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},R.acos=function(t){return new k(t).acos()},R.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},R.acosh=function(t){return new k(t).acosh()},R.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},R.asin=function(t){return new k(t).asin()},R.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},R.asinh=function(t){return new k(t).asinh()},R.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},R.atan=function(t){return new k(t).atan()},R.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},R.atanh=function(t){return new k(t).atanh()},R.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},R.cbrt=function(t){return new k(t).cbrt()},R.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},R.ceil=function(t){return new k(t).ceil()},R.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},R.clz32=function(t){return new k(t).clz32()},R.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},R.cos=function(t){return new k(t).cos()},R.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},R.cosh=function(t){return new k(t).cosh()},R.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},R.exp=function(t){return new k(t).exp()},R.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},R.expm1=function(t){return new k(t).expm1()},R.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},R.floor=function(t){return new k(t).floor()},R.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},R.fround=function(t){return new k(t).fround()},R.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},R.log=function(t){return new k(t).log()},R.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},R.log1p=function(t){return new k(t).log1p()},R.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},R.log10=function(t){return new k(t).log10()},R.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},R.log2=function(t){return new k(t).log2()},R.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},R.round=function(t){return new k(t).round()},R.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},R.sign=function(t){return new k(t).sign()},R.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},R.sin=function(t){return new k(t).sin()},R.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},R.sinh=function(t){return new k(t).sinh()},R.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},R.sqrt=function(t){return new k(t).sqrt()},R.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},R.tan=function(t){return new k(t).tan()},R.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},R.tanh=function(t){return new k(t).tanh()},R.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},R.trunc=function(t){return new k(t).trunc()},R.pow=function(t,e){return new k(t).pow(e)},R.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},R.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},R.prototype.powM=function(t){if(t=k.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this};class N extends S{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class z{constructor(t){let e,r,o,n,i,s,h,a,u,l=(t=N.checkMatrix(t)).clone(),f=l.rows,c=l.columns,m=new Float64Array(f),p=1;for(e=0;e<f;e++)m[e]=e;for(a=new Float64Array(f),r=0;r<c;r++){for(e=0;e<f;e++)a[e]=l.get(e,r);for(e=0;e<f;e++){for(u=Math.min(e,r),i=0,o=0;o<u;o++)i+=l.get(e,o)*a[o];a[e]-=i,l.set(e,r,a[e])}for(n=r,e=r+1;e<f;e++)Math.abs(a[e])>Math.abs(a[n])&&(n=e);if(n!==r){for(o=0;o<c;o++)s=l.get(n,o),l.set(n,o,l.get(r,o)),l.set(r,o,s);h=m[n],m[n]=m[r],m[r]=h,p=-p}if(r<f&&0!==l.get(r,r))for(e=r+1;e<f;e++)l.set(e,r,l.get(e,r)/l.get(r,r))}this.LU=l,this.pivotVector=m,this.pivotSign=p}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=E.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,o,n,i=t.columns,s=t.subMatrixRow(this.pivotVector,0,i-1),h=e.columns;for(n=0;n<h;n++)for(r=n+1;r<h;r++)for(o=0;o<i;o++)s.set(r,o,s.get(r,o)-s.get(n,o)*e.get(r,n));for(n=h-1;n>=0;n--){for(o=0;o<i;o++)s.set(n,o,s.get(n,o)/e.get(n,n));for(r=0;r<n;r++)for(o=0;o<i;o++)s.set(r,o,s.get(r,o)-s.get(n,o)*e.get(r,n))}return s}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let o=0;o<r;o++)e*=t.get(o,o);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new E(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n>e?o.set(n,e,t.get(n,e)):n===e?o.set(n,e,1):o.set(n,e,0);return o}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new E(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n<=e?o.set(n,e,t.get(n,e)):o.set(n,e,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function A(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class _{constructor(t){let e,r,o,n,i=(t=N.checkMatrix(t)).clone(),s=t.rows,h=t.columns,a=new Float64Array(h);for(o=0;o<h;o++){let t=0;for(e=o;e<s;e++)t=A(t,i.get(e,o));if(0!==t){for(i.get(o,o)<0&&(t=-t),e=o;e<s;e++)i.set(e,o,i.get(e,o)/t);for(i.set(o,o,i.get(o,o)+1),r=o+1;r<h;r++){for(n=0,e=o;e<s;e++)n+=i.get(e,o)*i.get(e,r);for(n=-n/i.get(o,o),e=o;e<s;e++)i.set(e,r,i.get(e,r)+n*i.get(e,o))}}a[o]=-t}this.QR=i,this.Rdiag=a}solve(t){t=E.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o,n,i,s,h=t.columns,a=t.clone(),u=e.columns;for(i=0;i<u;i++)for(n=0;n<h;n++){for(s=0,o=i;o<r;o++)s+=e.get(o,i)*a.get(o,n);for(s=-s/e.get(i,i),o=i;o<r;o++)a.set(o,n,a.get(o,n)+s*e.get(o,i))}for(i=u-1;i>=0;i--){for(n=0;n<h;n++)a.set(i,n,a.get(i,n)/this.Rdiag[i]);for(o=0;o<i;o++)for(n=0;n<h;n++)a.set(o,n,a.get(o,n)-a.get(i,n)*e.get(o,i))}return a.subMatrix(0,u-1,0,h-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,o=r.columns,n=new E(o,o);for(t=0;t<o;t++)for(e=0;e<o;e++)t<e?n.set(t,e,r.get(t,e)):t===e?n.set(t,e,this.Rdiag[t]):n.set(t,e,0);return n}get orthogonalMatrix(){let t,e,r,o,n=this.QR,i=n.rows,s=n.columns,h=new E(i,s);for(r=s-1;r>=0;r--){for(t=0;t<i;t++)h.set(t,r,0);for(h.set(r,r,1),e=r;e<s;e++)if(0!==n.get(r,r)){for(o=0,t=r;t<i;t++)o+=n.get(t,r)*h.get(t,e);for(o=-o/n.get(r,r),t=r;t<i;t++)h.set(t,e,h.get(t,e)+o*n.get(t,r))}}return h}}class P{constructor(t,e={}){let r=(t=N.checkMatrix(t)).rows,o=t.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:i=!0,autoTranspose:s=!1}=e;let h,a=Boolean(n),u=Boolean(i),l=!1;if(r<o)if(s){r=(h=t.transpose()).rows,o=h.columns,l=!0;let e=a;a=u,u=e}else h=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else h=t.clone();let f=Math.min(r,o),c=Math.min(r+1,o),m=new Float64Array(c),p=new E(r,f),g=new E(o,o),w=new Float64Array(o),d=new Float64Array(r),y=new Float64Array(c);for(let t=0;t<c;t++)y[t]=t;let v=Math.min(r-1,o),b=Math.max(0,Math.min(o-2,r)),M=Math.max(v,b);for(let t=0;t<M;t++){if(t<v){m[t]=0;for(let e=t;e<r;e++)m[t]=A(m[t],h.get(e,t));if(0!==m[t]){h.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)h.set(e,t,h.get(e,t)/m[t]);h.set(t,t,h.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<o;e++){if(t<v&&0!==m[t]){let o=0;for(let n=t;n<r;n++)o+=h.get(n,t)*h.get(n,e);o=-o/h.get(t,t);for(let n=t;n<r;n++)h.set(n,e,h.get(n,e)+o*h.get(n,t))}w[e]=h.get(t,e)}if(a&&t<v)for(let e=t;e<r;e++)p.set(e,t,h.get(e,t));if(t<b){w[t]=0;for(let e=t+1;e<o;e++)w[t]=A(w[t],w[e]);if(0!==w[t]){w[t+1]<0&&(w[t]=0-w[t]);for(let e=t+1;e<o;e++)w[e]/=w[t];w[t+1]+=1}if(w[t]=-w[t],t+1<r&&0!==w[t]){for(let e=t+1;e<r;e++)d[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<o;r++)d[e]+=w[r]*h.get(e,r);for(let e=t+1;e<o;e++){let o=-w[e]/w[t+1];for(let n=t+1;n<r;n++)h.set(n,e,h.get(n,e)+o*d[n])}}if(u)for(let e=t+1;e<o;e++)g.set(e,t,w[e])}}let S=Math.min(o,r+1);if(v<o&&(m[v]=h.get(v,v)),r<S&&(m[S-1]=0),b+1<S&&(w[b]=h.get(b,S-1)),w[S-1]=0,a){for(let t=v;t<f;t++){for(let e=0;e<r;e++)p.set(e,t,0);p.set(t,t,1)}for(let t=v-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<f;e++){let o=0;for(let n=t;n<r;n++)o+=p.get(n,t)*p.get(n,e);o=-o/p.get(t,t);for(let n=t;n<r;n++)p.set(n,e,p.get(n,e)+o*p.get(n,t))}for(let e=t;e<r;e++)p.set(e,t,-p.get(e,t));p.set(t,t,1+p.get(t,t));for(let e=0;e<t-1;e++)p.set(e,t,0)}else{for(let e=0;e<r;e++)p.set(e,t,0);p.set(t,t,1)}}if(u)for(let t=o-1;t>=0;t--){if(t<b&&0!==w[t])for(let e=t+1;e<o;e++){let r=0;for(let n=t+1;n<o;n++)r+=g.get(n,t)*g.get(n,e);r=-r/g.get(t+1,t);for(let n=t+1;n<o;n++)g.set(n,e,g.get(n,e)+r*g.get(n,t))}for(let e=0;e<o;e++)g.set(e,t,0);g.set(t,t,1)}let x=S-1,R=0,k=Number.EPSILON;for(;S>0;){let t,e;for(t=S-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+k*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(w[t])<=e||Number.isNaN(w[t])){w[t]=0;break}}if(t===S-2)e=4;else{let r;for(r=S-1;r>=t&&r!==t;r--){let e=(r!==S?Math.abs(w[r]):0)+(r!==t+1?Math.abs(w[r-1]):0);if(Math.abs(m[r])<=k*e){m[r]=0;break}}r===t?e=3:r===S-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=w[S-2];w[S-2]=0;for(let r=S-2;r>=t;r--){let n=A(m[r],e),i=m[r]/n,s=e/n;if(m[r]=n,r!==t&&(e=-s*w[r-1],w[r-1]=i*w[r-1]),u)for(let t=0;t<o;t++)n=i*g.get(t,r)+s*g.get(t,S-1),g.set(t,S-1,-s*g.get(t,r)+i*g.get(t,S-1)),g.set(t,r,n)}break}case 2:{let e=w[t-1];w[t-1]=0;for(let o=t;o<S;o++){let n=A(m[o],e),i=m[o]/n,s=e/n;if(m[o]=n,e=-s*w[o],w[o]=i*w[o],a)for(let e=0;e<r;e++)n=i*p.get(e,o)+s*p.get(e,t-1),p.set(e,t-1,-s*p.get(e,o)+i*p.get(e,t-1)),p.set(e,o,n)}break}case 3:{const e=Math.max(Math.abs(m[S-1]),Math.abs(m[S-2]),Math.abs(w[S-2]),Math.abs(m[t]),Math.abs(w[t])),n=m[S-1]/e,i=m[S-2]/e,s=w[S-2]/e,h=m[t]/e,l=w[t]/e,f=((i+n)*(i-n)+s*s)/2,c=n*s*(n*s);let d=0;0===f&&0===c||(d=c/(f+(d=f<0?0-Math.sqrt(f*f+c):Math.sqrt(f*f+c))));let y=(h+n)*(h-n)+d,v=h*l;for(let e=t;e<S-1;e++){let n=A(y,v);0===n&&(n=Number.MIN_VALUE);let i=y/n,s=v/n;if(e!==t&&(w[e-1]=n),y=i*m[e]+s*w[e],w[e]=i*w[e]-s*m[e],v=s*m[e+1],m[e+1]=i*m[e+1],u)for(let t=0;t<o;t++)n=i*g.get(t,e)+s*g.get(t,e+1),g.set(t,e+1,-s*g.get(t,e)+i*g.get(t,e+1)),g.set(t,e,n);if(0===(n=A(y,v))&&(n=Number.MIN_VALUE),i=y/n,s=v/n,m[e]=n,y=i*w[e]+s*m[e+1],m[e+1]=-s*w[e]+i*m[e+1],v=s*w[e+1],w[e+1]=i*w[e+1],a&&e<r-1)for(let t=0;t<r;t++)n=i*p.get(t,e)+s*p.get(t,e+1),p.set(t,e+1,-s*p.get(t,e)+i*p.get(t,e+1)),p.set(t,e,n)}w[S-2]=y,R+=1;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,u))for(let e=0;e<=x;e++)g.set(e,t,-g.get(e,t));for(;t<x&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,u&&t<o-1)for(let r=0;r<o;r++)e=g.get(r,t+1),g.set(r,t+1,g.get(r,t)),g.set(r,t,e);if(a&&t<r-1)for(let o=0;o<r;o++)e=p.get(o,t+1),p.set(o,t+1,p.get(o,t)),p.set(o,t,e);t++}R=0,S--}}if(l){let t=g;g=p,p=t}this.m=r,this.n=o,this.s=m,this.U=p,this.V=g}solve(t){let e=t,r=this.threshold,o=this.s.length,n=E.zeros(o,o);for(let t=0;t<o;t++)Math.abs(this.s[t])<=r?n.set(t,t,0):n.set(t,t,1/this.s[t]);let i=this.U,s=this.rightSingularVectors,h=s.mmul(n),a=s.rows,u=i.rows,l=E.zeros(a,u);for(let t=0;t<a;t++)for(let e=0;e<u;e++){let r=0;for(let n=0;n<o;n++)r+=h.get(t,n)*i.get(e,n);l.set(t,e,r)}return l.mmul(e)}solveForDiagonal(t){return this.solve(E.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,o=t.columns,n=new E(r,this.s.length);for(let i=0;i<r;i++)for(let r=0;r<o;r++)Math.abs(this.s[r])>e&&n.set(i,r,t.get(i,r)/this.s[r]);let i=this.U,s=i.rows,h=i.columns,a=new E(r,s);for(let t=0;t<r;t++)for(let e=0;e<s;e++){let r=0;for(let o=0;o<h;o++)r+=n.get(t,o)*i.get(e,o);a.set(t,e,r)}return a}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let o=0,n=r.length;o<n;o++)r[o]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return E.diag(this.s)}}function C(t,e=!1){return t=N.checkMatrix(t),e?new P(t).inverse():function(t,e,r=!1){return t=N.checkMatrix(t),e=N.checkMatrix(e),r?new P(t).solve(e):t.isSquare()?new z(t).solve(e):new _(t).solve(e)}(t,E.eye(t.rows))}function F(t,e,r,o,n){var i=r*o*o,s=E.eye(e.length,e.length,i);const h=n(e);var a=t.x.map(t=>h(t)),u=function(t,e,r,o,n){const i=r.length,s=t.x.length;for(var h=new Array(i),a=0;a<i;a++){h[a]=new Array(s);var u=r.concat();u[a]+=o;for(var l=n(u),f=0;f<s;f++)h[a][f]=e[f]-l(t.x[f])}return new E(h)}(t,a,e,o,n),l=function(t,e){const r=t.x.length;for(var o=new Array(r),n=0;n<r;n++)o[n]=[t.y[n]-e[n]];return new E(o)}(t,a),f=C(s.add(u.mmul(u.transpose())));return(e=(e=new E([e])).sub(f.mmul(u).mmul(l).mul(o).transpose())).to1DArray()}function T(t,e,r={}){let{maxIterations:n=100,gradientDifference:i=.1,damping:s=0,errorTolerance:h=.01,minValues:a,maxValues:u,initialValues:l}=r;if(s<=0)throw new Error("The damping option must be a positive number");if(!t.x||!t.y)throw new Error("The data parameter must have x and y elements");if(!Array.isArray(t.x)||t.x.length<2||!Array.isArray(t.y)||t.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(t.x.length!==t.y.length)throw new Error("The data parameter elements must have the same size");var f=l||new Array(e.length).fill(1);let c=f.length;if(u=u||new Array(c).fill(Number.MAX_SAFE_INTEGER),a=a||new Array(c).fill(Number.MIN_SAFE_INTEGER),u.length!==a.length)throw new Error("minValues and maxValues must be the same size");if(!Array.isArray(f))throw new Error("initialValues must be an array");for(var m=o(t,f,e),p=m<=h,g=0;g<n&&!p;g++){f=F(t,f,s,i,e);for(let t=0;t<c;t++)f[t]=Math.min(Math.max(a[t],f[t]),u[t]);if(m=o(t,f,e),isNaN(m))break;p=m<=h}return{parameterValues:f,parameterError:m,iterations:g}}r.d(e,"default",function(){return T})}])});